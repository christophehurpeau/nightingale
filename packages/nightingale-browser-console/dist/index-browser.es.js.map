{"version":3,"file":"index-browser.es.js","sources":["../src/debug.ts","../src/index.ts"],"sourcesContent":["export function getDebugString(): string {\n  const querystring = document.location?.search;\n  const debugFromLocalStorage =\n    (window.localStorage && localStorage.getItem('debug')) || '';\n\n  if (!querystring) {\n    return debugFromLocalStorage;\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/URLUtils/search#Get_the_value_of_a_single_search_param\n  const debugFromQueryString = decodeURI(\n    querystring.replace(\n      // eslint-disable-next-line prefer-regex-literals\n      new RegExp('^(?:.*[&\\\\?]DEBUG(?:\\\\=([^&]*))?)?.*$', 'i'),\n      '$1',\n    ),\n  );\n\n  return (\n    (debugFromLocalStorage ? `${debugFromLocalStorage},` : '') +\n    debugFromQueryString\n  );\n}\n","import { createBrowserConsoleFormatter } from 'nightingale-browser-console-formatter';\nimport consoleOutput from 'nightingale-console-output';\nimport { createFindDebugLevel } from 'nightingale-debug';\nimport type {\n  Level,\n  Handle,\n  IsHandling,\n  LogRecord,\n  Metadata,\n  Handler,\n} from 'nightingale-types';\nimport { getDebugString } from './debug';\n\n// debug string can change any time (localStorage), so we need a new object each time.\nconst findDebugLevel = (minLevel: Level, key: string): Level =>\n  createFindDebugLevel(getDebugString())(minLevel, key);\n\ntype Theme = 'dark' | 'light';\n\nconst getDefaultTheme = (): Theme => {\n  try {\n    const configInLocalStorage = localStorage.getItem('NIGHTINGALE_THEME');\n    if (configInLocalStorage && configInLocalStorage === 'dark') {\n      return configInLocalStorage;\n    }\n  } catch {}\n  return 'light';\n};\n\nconst createHandler = (theme: Theme = getDefaultTheme()): Handle => {\n  const browserConsoleFormatter = createBrowserConsoleFormatter(theme);\n  return <T extends Metadata>(record: LogRecord<T>) => {\n    consoleOutput(browserConsoleFormatter(record), record);\n  };\n};\n\nexport interface BrowserConsoleHandlerOptions {\n  theme?: Theme;\n}\n\nexport class BrowserConsoleHandler implements Handler {\n  minLevel: Level = 0;\n\n  handle: Handle;\n\n  isHandling: IsHandling;\n\n  constructor(minLevel: Level, options: BrowserConsoleHandlerOptions = {}) {\n    this.isHandling = (level: Level, key: string) =>\n      level >= findDebugLevel(minLevel, key);\n\n    this.handle = createHandler(options.theme);\n  }\n}\n"],"names":["getDebugString","_document$location","querystring","document","location","search","debugFromLocalStorage","window","localStorage","getItem","debugFromQueryString","decodeURI","replace","RegExp","findDebugLevel","minLevel","key","createFindDebugLevel","getDefaultTheme","configInLocalStorage","_unused","createHandler","theme","browserConsoleFormatter","createBrowserConsoleFormatter","record","consoleOutput","BrowserConsoleHandler","options","isHandling","level","handle"],"mappings":";;;;AAAO,SAASA,cAAcA,GAAW;AAAA,EAAA,IAAAC,kBAAA,CAAA;EACvC,IAAMC,WAAW,GAAAD,CAAAA,kBAAA,GAAGE,QAAQ,CAACC,QAAQ,KAAA,IAAA,GAAA,KAAA,CAAA,GAAjBH,kBAAA,CAAmBI,MAAM,CAAA;AAC7C,EAAA,IAAMC,qBAAqB,GACxBC,MAAM,CAACC,YAAY,IAAIA,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,IAAK,EAAE,CAAA;EAE9D,IAAI,CAACP,WAAW,EAAE;AAChB,IAAA,OAAOI,qBAAqB,CAAA;AAC9B,GAAA;;AAEA;AACA,EAAA,IAAMI,oBAAoB,GAAGC,SAAS,CACpCT,WAAW,CAACU,OAAO;AACjB;EACA,IAAIC,MAAM,CAAC,uCAAuC,EAAE,GAAG,CAAC,EACxD,IACF,CACF,CAAC,CAAA;AAED,EAAA,OACE,CAACP,qBAAqB,GAAMA,qBAAqB,GAAM,GAAA,GAAA,EAAE,IACzDI,oBAAoB,CAAA;AAExB;;ACTA;AACA,IAAMI,cAAc,GAAG,SAAjBA,cAAcA,CAAIC,QAAe,EAAEC,GAAW,EAAA;EAAA,OAClDC,oBAAoB,CAACjB,cAAc,EAAE,CAAC,CAACe,QAAQ,EAAEC,GAAG,CAAC,CAAA;AAAA,CAAA,CAAA;AAIvD,IAAME,eAAe,GAAG,SAAlBA,eAAeA,GAAgB;AAAA,EAAA,IAE3BC,oBAAgE,CAAA;EADxE,IAAI;AACIA,IAAAA,oBAAoB,GAAGX,YAAY,CAACC,OAAO,CAAC,mBAAmB,CAAC,CAAA;AACtE,IAAA,IAAIU,oBAAoB,IAAIA,oBAAoB,KAAK,MAAM,EAAE;AAC3D,MAAA,OAAOA,oBAAoB,CAAA;AAC7B,KAAA;AACF,GAAC,CAAC,OAAAC,OAAA,EAAM,EAAC;AACT,EAAA,OAAO,OAAO,CAAA;AAChB,CAAC,CAAA;AAED,IAAMC,aAAa,GAAG,SAAhBA,aAAaA,CAAIC,KAAY,EAAiC;AAAA,EAAA,IAA7CA,KAAY,KAAA,KAAA,CAAA,EAAA;IAAZA,KAAY,GAAGJ,eAAe,EAAE,CAAA;AAAA,GAAA;AACrD,EAAA,IAAMK,uBAAuB,GAAGC,6BAA6B,CAACF,KAAK,CAAC,CAAA;EACpE,OAAO,UAAqBG,MAAoB,EAAK;AACnDC,IAAAA,aAAa,CAACH,uBAAuB,CAACE,MAAM,CAAC,EAAEA,MAAM,CAAC,CAAA;GACvD,CAAA;AACH,CAAC,CAAA;AAMD,IAAaE,qBAAqB,GAOhC,SAAAA,sBAAYZ,QAAe,EAAEa,OAAqC,EAAO;AAAA,EAAA,IAA5CA,OAAqC,KAAA,KAAA,CAAA,EAAA;IAArCA,OAAqC,GAAG,EAAE,CAAA;AAAA,GAAA;EAAA,IANvEb,CAAAA,QAAQ,GAAU,CAAC,CAAA;AAOjB,EAAA,IAAI,CAACc,UAAU,GAAG,UAACC,KAAY,EAAEd,GAAW,EAAA;AAAA,IAAA,OAC1Cc,KAAK,IAAIhB,cAAc,CAACC,QAAQ,EAAEC,GAAG,CAAC,CAAA;AAAA,GAAA,CAAA;EAExC,IAAI,CAACe,MAAM,GAAGV,aAAa,CAACO,OAAO,CAACN,KAAK,CAAC,CAAA;AAC5C;;;;"}