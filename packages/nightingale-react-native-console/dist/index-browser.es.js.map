{"version":3,"file":"index-browser.es.js","sources":["../src/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-argument */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport formatterANSI from 'nightingale-ansi-formatter';\nimport type {\n  Level,\n  Handle,\n  IsHandling,\n  LogRecord,\n  Metadata,\n  Handler,\n} from 'nightingale-types';\nimport { Platform } from 'react-native';\nimport parseErrorStack from 'react-native/Libraries/Core/Devtools/parseErrorStack';\nimport symbolicateStackTrace from 'react-native/Libraries/Core/Devtools/symbolicateStackTrace';\n\nconst getStackTrace = (e: Error): any => {\n  // eslint-disable-next-line no-prototype-builtins\n  if (Platform.hasOwnProperty('constants')) {\n    // RN version >= 0.63\n    if (Platform.constants.reactNativeVersion.minor >= 64) {\n      // RN version >= 0.64 -> Stacktrace as string\n      return parseErrorStack(e.stack as unknown as any);\n    }\n    // RN version == 0.63 -> Stacktrace as string\n    else return parseErrorStack(e);\n  }\n  // RN version < 0.63 -> Stacktrace as string\n  else return parseErrorStack(e);\n};\n\nfunction parsedStackToString(stack: any[]): string {\n  return stack\n    .map(\n      (frame) =>\n        `  at ${frame.file}${\n          frame.lineNumber\n            ? `:${frame.lineNumber}${frame.column ? `:${frame.column}` : ''}`\n            : ''\n        }${frame.methodName ? ` in ${frame.methodName}` : ''}`,\n    )\n    .join('\\n');\n}\n\nfunction consoleOutput<T extends Metadata>(\n  param: string[] | string,\n  record: LogRecord<T>,\n): void {\n  // eslint-disable-next-line no-console\n  console.log(...param);\n}\n\nconst createHandle = (): Handle => {\n  return <T extends Metadata>(record: LogRecord<T>): void => {\n    const metadataError = record.metadata?.error;\n    if (metadataError && metadataError instanceof Error) {\n      delete record.metadata?.error;\n      symbolicateStackTrace(getStackTrace(metadataError))\n        .then(({ stack, codeFrame }: any) => {\n          metadataError.stack = parsedStackToString(stack);\n          consoleOutput([formatterANSI(record)], record);\n        })\n        .catch((error) => {\n          consoleOutput([formatterANSI(record)], record);\n        });\n    } else {\n      consoleOutput([formatterANSI(record)], record);\n    }\n  };\n};\n\nexport class ReactNativeConsoleHandler implements Handler {\n  minLevel: Level = 0;\n\n  handle: Handle;\n\n  isHandling: IsHandling;\n\n  constructor(minLevel: Level) {\n    this.minLevel = minLevel;\n    this.isHandling = (level: Level) => level >= minLevel;\n    this.handle = createHandle();\n  }\n}\n"],"names":["getStackTrace","e","Platform","hasOwnProperty","constants","reactNativeVersion","minor","parseErrorStack","stack","parsedStackToString","map","frame","file","lineNumber","column","methodName","join","consoleOutput","param","_console","console","log","apply","createHandle","record","_record$metadata","_record$metadata2","metadataError","metadata","error","Error","symbolicateStackTrace","then","_ref","codeFrame","formatterANSI","catch","ReactNativeConsoleHandler","minLevel","isHandling","level","handle"],"mappings":";;;;;AAAA;AACA;AACA;AAcA,IAAMA,aAAa,GAAG,SAAhBA,aAAaA,CAAIC,CAAQ,EAAU;AACvC;AACA,EAAA,IAAIC,QAAQ,CAACC,cAAc,CAAC,WAAW,CAAC,EAAE;AACxC;IACA,IAAID,QAAQ,CAACE,SAAS,CAACC,kBAAkB,CAACC,KAAK,IAAI,EAAE,EAAE;AACrD;AACA,MAAA,OAAOC,eAAe,CAACN,CAAC,CAACO,KAAuB,CAAC,CAAA;AACnD,KAAA;AACA;AAAA,SACK,OAAOD,eAAe,CAACN,CAAC,CAAC,CAAA;AAChC,GAAA;AACA;AAAA,OACK,OAAOM,eAAe,CAACN,CAAC,CAAC,CAAA;AAChC,CAAC,CAAA;AAED,SAASQ,mBAAmBA,CAACD,KAAY,EAAU;AACjD,EAAA,OAAOA,KAAK,CACTE,GAAG,CACF,UAACC,KAAK,EAAA;AAAA,IAAA,OAAA,OAAA,GACIA,KAAK,CAACC,IAAI,IAChBD,KAAK,CAACE,UAAU,GACRF,GAAAA,GAAAA,KAAK,CAACE,UAAU,IAAGF,KAAK,CAACG,MAAM,GAAA,GAAA,GAAOH,KAAK,CAACG,MAAM,GAAK,EAAE,CAAA,GAC7D,EAAE,CACLH,IAAAA,KAAK,CAACI,UAAU,GAAUJ,MAAAA,GAAAA,KAAK,CAACI,UAAU,GAAK,EAAE,CAAA,CAAA;AAAA,GACxD,CAAC,CACAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,CAAA;AAEA,SAASC,aAAaA,CACpBC,KAAwB,EAElB;AAAA,EAAA,IAAAC,QAAA,CAAA;AACN;EACA,CAAAA,QAAA,GAAAC,OAAO,EAACC,GAAG,CAAAC,KAAA,CAAAH,QAAA,EAAID,KAAK,CAAC,CAAA;AACvB,CAAA;AAEA,IAAMK,YAAY,GAAG,SAAfA,YAAYA,GAAiB;EACjC,OAAO,UAAqBC,MAAoB,EAAW;IAAA,IAAAC,gBAAA,EAAAC,iBAAA,CAAA;IACzD,IAAMC,aAAa,GAAAF,CAAAA,gBAAA,GAAGD,MAAM,CAACI,QAAQ,KAAA,IAAA,GAAA,KAAA,CAAA,GAAfH,gBAAA,CAAiBI,KAAK,CAAA;AAC5C,IAAA,IAAIF,aAAa,IAAIA,aAAa,YAAYG,KAAK,EAAE;MACnD,CAAAJ,iBAAA,GAAOF,MAAM,CAACI,QAAQ,KAAtB,IAAA,GAAA,IAAA,GAAA,OAAOF,iBAAA,CAAiBG,KAAK,CAAA;MAC7BE,qBAAqB,CAAC/B,aAAa,CAAC2B,aAAa,CAAC,CAAC,CAChDK,IAAI,CAAC,UAAAC,IAAA,EAA+B;AAAA,QAAA,IAA5BzB,KAAK,GAAAyB,IAAA,CAALzB,KAAK,CAAA;UAAWyB,IAAA,CAATC,UAAS;AACvBP,QAAAA,aAAa,CAACnB,KAAK,GAAGC,mBAAmB,CAACD,KAAK,CAAC,CAAA;QAChDS,aAAa,CAAC,CAACkB,aAAa,CAACX,MAAM,CAAC,CAAS,CAAC,CAAA;AAChD,OAAC,CAAC,CACDY,KAAK,CAAC,YAAW;QAChBnB,aAAa,CAAC,CAACkB,aAAa,CAACX,MAAM,CAAC,CAAS,CAAC,CAAA;AAChD,OAAC,CAAC,CAAA;AACN,KAAC,MAAM;MACLP,aAAa,CAAC,CAACkB,aAAa,CAACX,MAAM,CAAC,CAAS,CAAC,CAAA;AAChD,KAAA;GACD,CAAA;AACH,CAAC,CAAA;AAED,IAAaa,yBAAyB,GAOpC,SAAAA,yBAAAA,CAAYC,QAAe,EAAE;EAAA,IAN7BA,CAAAA,QAAQ,GAAU,CAAC,CAAA;EAOjB,IAAI,CAACA,QAAQ,GAAGA,QAAQ,CAAA;AACxB,EAAA,IAAI,CAACC,UAAU,GAAG,UAACC,KAAY,EAAA;IAAA,OAAKA,KAAK,IAAIF,QAAQ,CAAA;AAAA,GAAA,CAAA;AACrD,EAAA,IAAI,CAACG,MAAM,GAAGlB,YAAY,EAAE,CAAA;AAC9B;;;;"}