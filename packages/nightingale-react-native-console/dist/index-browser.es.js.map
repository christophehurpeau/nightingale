{"version":3,"file":"index-browser.es.js","sources":["../src/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-argument */\n\nimport { ANSIFormatter } from \"nightingale\";\nimport type {\n  Handle,\n  Handler,\n  IsHandling,\n  Level,\n  LogRecord,\n  Metadata,\n} from \"nightingale-types\";\nimport { Platform } from \"react-native\";\nimport type { StackFrame } from \"react-native/Libraries/Core/Devtools/parseErrorStack\";\nimport parseErrorStack from \"react-native/Libraries/Core/Devtools/parseErrorStack\";\nimport symbolicateStackTrace from \"react-native/Libraries/Core/Devtools/symbolicateStackTrace\";\n\nconst getStackTrace = (e: Error): any => {\n  // eslint-disable-next-line no-prototype-builtins\n  if (Platform.hasOwnProperty(\"constants\")) {\n    // RN version >= 0.63\n    if (Platform.constants.reactNativeVersion.minor >= 64) {\n      // RN version >= 0.64 -> Stacktrace as string\n      return parseErrorStack(e.stack as unknown as any);\n    }\n    // RN version == 0.63 -> Stacktrace as string\n    else return parseErrorStack(e);\n  }\n  // RN version < 0.63 -> Stacktrace as string\n  else return parseErrorStack(e);\n};\n\nfunction parsedStackToString(stack: StackFrame[]): string {\n  return stack\n    .map(\n      (frame) =>\n        `  at ${frame.file}${\n          frame.lineNumber\n            ? `:${frame.lineNumber}${frame.column ? `:${frame.column}` : \"\"}`\n            : \"\"\n        }${frame.methodName ? ` in ${frame.methodName}` : \"\"}`,\n    )\n    .join(\"\\n\");\n}\n\nfunction consoleOutput<T extends Metadata>(\n  param: string[],\n  record: LogRecord<T>,\n): void {\n  // eslint-disable-next-line no-console\n  console.log(...param);\n}\n\nconst createHandle = (): Handle => {\n  return <T extends Metadata>(record: LogRecord<T>): void => {\n    const metadataError = record.metadata?.error;\n    if (metadataError && metadataError instanceof Error) {\n      symbolicateStackTrace(getStackTrace(metadataError))\n        .then(({ stack, codeFrame }: any) => {\n          metadataError.stack = parsedStackToString(stack);\n          consoleOutput(ANSIFormatter.format(record), record);\n        })\n        .catch((error: unknown) => {\n          metadataError.stack = undefined;\n          consoleOutput(ANSIFormatter.format(record), record);\n        });\n    } else {\n      consoleOutput(ANSIFormatter.format(record), record);\n    }\n  };\n};\n\nexport class ReactNativeConsoleHandler implements Handler {\n  minLevel: Level = 0;\n\n  handle: Handle;\n\n  isHandling: IsHandling;\n\n  constructor(minLevel: Level) {\n    this.minLevel = minLevel;\n    this.isHandling = (level: Level) => level >= minLevel;\n    this.handle = createHandle();\n  }\n}\n"],"names":[],"mappings":";;;;;AAgBA,MAAM,aAAA,GAAgB,CAAC,CAAA,KAAkB;AAEvC,EAAA,IAAI,QAAA,CAAS,cAAA,CAAe,WAAW,CAAA,EAAG;AAExC,IAAA,IAAI,QAAA,CAAS,SAAA,CAAU,kBAAA,CAAmB,KAAA,IAAS,EAAA,EAAI;AAErD,MAAA,OAAO,eAAA,CAAgB,EAAE,KAAuB,CAAA;AAAA,IAClD,CAAA,MAEK,OAAO,eAAA,CAAgB,CAAC,CAAA;AAAA,EAC/B,CAAA,MAEK,OAAO,eAAA,CAAgB,CAAC,CAAA;AAC/B,CAAA;AAEA,SAAS,oBAAoB,KAAA,EAA6B;AACxD,EAAA,OAAO,KAAA,CACJ,GAAA;AAAA,IACC,CAAC,KAAA,KACC,CAAA,KAAA,EAAQ,KAAA,CAAM,IAAI,CAAA,EAChB,KAAA,CAAM,UAAA,GACF,CAAA,CAAA,EAAI,KAAA,CAAM,UAAU,CAAA,EAAG,KAAA,CAAM,MAAA,GAAS,CAAA,CAAA,EAAI,KAAA,CAAM,MAAM,CAAA,CAAA,GAAK,EAAE,CAAA,CAAA,GAC7D,EACN,CAAA,EAAG,KAAA,CAAM,UAAA,GAAa,CAAA,IAAA,EAAO,KAAA,CAAM,UAAU,CAAA,CAAA,GAAK,EAAE,CAAA;AAAA,GACxD,CACC,KAAK,IAAI,CAAA;AACd;AAEA,SAAS,aAAA,CACP,OACA,MAAA,EACM;AAEN,EAAA,OAAA,CAAQ,GAAA,CAAI,GAAG,KAAK,CAAA;AACtB;AAEA,MAAM,eAAe,MAAc;AACjC,EAAA,OAAO,CAAqB,MAAA,KAA+B;AACzD,IAAA,MAAM,aAAA,GAAgB,OAAO,QAAA,EAAU,KAAA;AACvC,IAAA,IAAI,aAAA,IAAiB,yBAAyB,KAAA,EAAO;AACnD,MAAA,qBAAA,CAAsB,aAAA,CAAc,aAAa,CAAC,CAAA,CAC/C,KAAK,CAAC,EAAE,KAAA,EAAO,SAAA,EAAU,KAAW;AACnC,QAAA,aAAA,CAAc,KAAA,GAAQ,oBAAoB,KAAK,CAAA;AAC/C,QAAA,aAAA,CAAc,aAAA,CAAc,MAAA,CAAO,MAAM,CAAS,CAAA;AAAA,MACpD,CAAC,CAAA,CACA,KAAA,CAAM,CAAC,KAAA,KAAmB;AACzB,QAAA,aAAA,CAAc,KAAA,GAAQ,MAAA;AACtB,QAAA,aAAA,CAAc,aAAA,CAAc,MAAA,CAAO,MAAM,CAAS,CAAA;AAAA,MACpD,CAAC,CAAA;AAAA,IACL,CAAA,MAAO;AACL,MAAA,aAAA,CAAc,aAAA,CAAc,MAAA,CAAO,MAAM,CAAS,CAAA;AAAA,IACpD;AAAA,EACF,CAAA;AACF,CAAA;AAEO,MAAM,yBAAA,CAA6C;AAAA,EAOxD,YAAY,QAAA,EAAiB;AAN7B,IAAA,IAAA,CAAA,QAAA,GAAkB,CAAA;AAOhB,IAAA,IAAA,CAAK,QAAA,GAAW,QAAA;AAChB,IAAA,IAAA,CAAK,UAAA,GAAa,CAAC,KAAA,KAAiB,KAAA,IAAS,QAAA;AAC7C,IAAA,IAAA,CAAK,SAAS,YAAA,EAAa;AAAA,EAC7B;AACF;;;;"}