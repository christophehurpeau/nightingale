{"version":3,"file":"index-node14.mjs","sources":["../src/index.ts"],"sourcesContent":["/* eslint-disable max-lines */\nimport { POB_TARGET } from 'pob-babel';\nimport * as util from 'util';\nimport { Level } from 'nightingale-levels';\nimport type {\n  Metadata,\n  MetadataStyles,\n  Styles,\n  Handler,\n  Processor,\n  LogRecord,\n} from 'nightingale-types';\n\nexport { Level } from 'nightingale-levels';\n\nexport interface Options<T extends Metadata> {\n  symbol?: string;\n  metadataStyles?: MetadataStyles<T>;\n  styles?: Styles;\n}\n\nexport interface ComputedConfigForKey {\n  handlers: Handler[];\n  processors: Processor[];\n}\n\ninterface ExtendedFunctionNameMetadata {\n  functionName: string;\n}\n\nexport interface Config {\n  handler?: Handler;\n  handlers?: Handler[];\n  key?: string;\n  keys?: string[];\n  pattern?: RegExp;\n  processor?: Processor;\n  processors?: Processor[];\n  stop?: boolean;\n}\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace NodeJS {\n    interface Global {\n      __NIGHTINGALE_CONFIG: Config[];\n      __NIGHTINGALE_LOGGER_MAP_CACHE: Map<string, ComputedConfigForKey>;\n      __NIGHTINGALE_CONFIG_DEFAULT: ComputedConfigForKey;\n      __NIGHTINGALE_GLOBAL_HANDLERS: unknown;\n      __NIGHTINGALE_GET_CONFIG_FOR_LOGGER: (\n        key: string,\n      ) => ComputedConfigForKey;\n      __NIGHTINGALE_GET_CONFIG_FOR_LOGGER_RECORD: (\n        key: string,\n        level: number,\n      ) => ComputedConfigForKey;\n    }\n  }\n}\n\nconst globalOrWindow: typeof global =\n  typeof global !== 'undefined' ? global : (window as typeof global);\n\nif (!globalOrWindow.__NIGHTINGALE_GET_CONFIG_FOR_LOGGER) {\n  globalOrWindow.__NIGHTINGALE_GET_CONFIG_FOR_LOGGER =\n    (): ComputedConfigForKey => ({\n      handlers: [],\n      processors: [],\n    });\n}\n\nif (!globalOrWindow.__NIGHTINGALE_GET_CONFIG_FOR_LOGGER_RECORD) {\n  globalOrWindow.__NIGHTINGALE_GET_CONFIG_FOR_LOGGER_RECORD = (\n    key: string,\n    level: number,\n  ): ComputedConfigForKey => {\n    const { handlers, processors }: ComputedConfigForKey =\n      globalOrWindow.__NIGHTINGALE_GET_CONFIG_FOR_LOGGER(key);\n\n    return {\n      handlers: handlers.filter(\n        (handler) =>\n          level >= handler.minLevel &&\n          (!handler.isHandling || handler.isHandling(level, key)),\n      ),\n      processors,\n    };\n  };\n}\n\n/** @private */\nfunction getConfigForLoggerRecord(\n  key: string,\n  recordLevel: Level,\n): ComputedConfigForKey {\n  return globalOrWindow.__NIGHTINGALE_GET_CONFIG_FOR_LOGGER_RECORD(\n    key,\n    recordLevel,\n  );\n}\n\nfunction isError(messageOrError: Error | string): messageOrError is Error {\n  return messageOrError instanceof Error;\n}\n\n/**\n * Interface that allows you to log records.\n * This records are treated by handlers\n */\nexport class Logger {\n  private contextObject?: Record<string, unknown>;\n\n  readonly key: string;\n\n  readonly displayName?: string;\n\n  /**\n   * Create a new Logger\n   *\n   * @param {string} key\n   * @param {string} [displayName]\n   */\n  constructor(key: string, displayName?: string) {\n    this.key = key;\n    this.displayName = displayName;\n\n    if (__DEV__ && key.includes('.')) {\n      throw new Error(\n        `nightingale: \\`.\\` in key is no longer supported, use \\`:\\` instead (key: ${key})`,\n      );\n    }\n  }\n\n  /** @private */\n  protected getHandlersAndProcessors(\n    recordLevel: number,\n  ): ComputedConfigForKey {\n    return getConfigForLoggerRecord(this.key, recordLevel);\n  }\n\n  /** @private */\n  getConfig(): Readonly<ComputedConfigForKey> {\n    return globalOrWindow.__NIGHTINGALE_GET_CONFIG_FOR_LOGGER(this.key);\n  }\n\n  /**\n   * Create a child logger\n   */\n  child(childSuffixKey: string, childDisplayName?: string): Logger {\n    return new Logger(`${this.key}:${childSuffixKey}`, childDisplayName);\n  }\n\n  /**\n   * Create a new Logger with the same key a this attached context\n   *\n   * @example\n   * ```typescript\n   * const loggerMyService = new Logger('app:myService');\n   * function someAction(arg1) {\n   *     const logger = loggerMyService.context({ arg1 });\n   *     logger.enter(someAction);\n   *     // do stuff\n   *     logger.info('info');\n   *     // do stuff\n   *     logger.exit(someAction);\n   * }\n   * ```\n   *\n   */\n  context(context: Record<string, unknown>): Logger {\n    const logger = new Logger(this.key);\n    logger.setContext(context);\n    return logger;\n  }\n\n  /**\n   * Get the context of this logger\n   */\n  getContextObject(): Readonly<Record<string, unknown>> | undefined {\n    return this.contextObject;\n  }\n\n  /**\n   * Set the context of this logger\n   *\n   * @param {Object} context\n   */\n  setContext(context: Record<string, unknown>): void {\n    this.contextObject = context;\n  }\n\n  /**\n   * Extends existing context of this logger\n   */\n  extendsContext(extendedContext: Record<string, unknown>): void {\n    if (this.contextObject === undefined) {\n      throw new Error(\n        'Cannot extends context that does not exists. Use setContext(context) first.',\n      );\n    }\n    Object.assign(this.contextObject, extendedContext);\n  }\n\n  /**\n   * Handle a record\n   *\n   * Use this only if you know what you are doing.\n   */\n  addRecord<T extends Metadata>(record: Readonly<LogRecord<T>>): void {\n    const { handlers, processors } = this.getHandlersAndProcessors(\n      record.level,\n    );\n\n    if (handlers.length === 0) {\n      if (record.level > Level.ERROR) {\n        // eslint-disable-next-line no-console\n        console.log('[nightingale] no logger for > error level.', {\n          key: record.key,\n          message: record.message,\n        });\n      }\n      return;\n    }\n\n    if (processors) {\n      processors.forEach((process) => {\n        process(record, record.context);\n      });\n    }\n\n    handlers.some((handler) => handler.handle(record) === false);\n  }\n\n  /**\n   * Log a message\n   */\n  log<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    level: Level = Level.INFO,\n    options?: Options<T>,\n  ): void {\n    const isMessageError = isError(messageOrError);\n\n    const message = isMessageError\n      ? `${messageOrError.name}: ${messageOrError.message}`\n      : messageOrError;\n\n    const extendedMetadata =\n      isMessageError &&\n      !(metadata && Object.prototype.hasOwnProperty.call(metadata, 'error'))\n        ? { ...metadata, error: messageOrError }\n        : metadata;\n\n    const context = extendedMetadata?.context;\n    if (extendedMetadata) {\n      delete extendedMetadata.context;\n    }\n\n    const record: LogRecord<NonNullable<typeof extendedMetadata>> = {\n      level,\n      key: this.key,\n      displayName: this.displayName,\n      datetime: new Date(),\n      message,\n      context: context || this.contextObject,\n      metadata: extendedMetadata as NonNullable<typeof extendedMetadata>,\n      extra: {},\n      ...options,\n    };\n    this.addRecord(record);\n  }\n\n  /**\n   * Log a trace message\n   */\n  trace<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.TRACE, { metadataStyles });\n  }\n\n  /**\n   * Log a debug message\n   */\n  debug<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.DEBUG, { metadataStyles });\n  }\n\n  /**\n   * Notice an info message\n   */\n  notice<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.NOTICE, { metadataStyles });\n  }\n\n  /**\n   * Log an info message\n   */\n  info<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.INFO, { metadataStyles });\n  }\n\n  /**\n   * Log a warn message\n   */\n  warn<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.WARN, { metadataStyles });\n  }\n\n  /**\n   * Log an error message\n   *\n   * @example\n   * ```typescript\n   * const logger = new Logger('something');\n   * try {\n   *   throw new Error('Always throws here');\n   * } catch (error) {\n   *   logger.error('caught error', { error });\n   * }\n   * ```\n   */\n  error<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.ERROR, { metadataStyles });\n  }\n\n  /**\n   * Log an critical message\n   */\n  critical<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.CRITICAL, { metadataStyles });\n  }\n\n  /**\n   * Log a fatal message\n   *\n   * @example\n   * ```typescript\n   * const logger = new Logger('something');\n   * try {\n   *   throw new Error('Always throws here');\n   * } catch (error) {\n   *   logger.error('caught error', { error });\n   *   process.exit(1);\n   * }\n   */\n  fatal<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.FATAL, { metadataStyles });\n  }\n\n  /**\n   * Log an alert message\n   */\n  alert<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.ALERT, { metadataStyles });\n  }\n\n  /**\n   * Log an inspected value\n   */\n  inspectValue<T extends Metadata>(\n    value: unknown,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    if (POB_TARGET === 'browser') {\n      throw new Error('Not supported for the browser. Prefer `debugger;`');\n    } else {\n      // Note: inspect is a special function for node:\n      // https://github.com/nodejs/node/blob/a1bda1b4deb08dfb3e06cb778f0db40023b18318/lib/util.js#L210\n      const inspectedValue = util.inspect(value, { depth: 6 });\n      this.log(inspectedValue, metadata, Level.DEBUG, {\n        metadataStyles,\n        styles: ['gray'],\n      });\n    }\n  }\n\n  /**\n   * Log a debugged var\n   */\n  inspectVar<T extends Metadata>(\n    varName: string,\n    varValue: unknown,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    if (POB_TARGET === 'browser') {\n      throw new Error('Not supported for the browser. Prefer `debugger;`');\n    } else {\n      const inspectedValue = util.inspect(varValue, { depth: 6 });\n      this.log(`${varName} = ${inspectedValue}`, metadata, Level.DEBUG, {\n        metadataStyles,\n        styles: ['cyan'],\n      });\n    }\n  }\n\n  /**\n   * Alias for infoSuccess\n   */\n  success<T extends Metadata>(\n    message: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.infoSuccess(message, metadata, metadataStyles);\n  }\n\n  /**\n   * Log an info success message\n   */\n  infoSuccess<T extends Metadata>(\n    message: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(message, metadata, Level.INFO, {\n      metadataStyles,\n      symbol: '✔',\n      styles: ['green', 'bold'],\n    });\n  }\n\n  /**\n   * Log an debug success message\n   */\n  debugSuccess<T extends Metadata>(\n    message: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(message, metadata, Level.DEBUG, {\n      metadataStyles,\n      symbol: '✔',\n      styles: ['green'],\n    });\n  }\n\n  /**\n   * Alias for infoFail\n   */\n  fail<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.infoFail(messageOrError, metadata, metadataStyles);\n  }\n\n  /**\n   * Log an info fail message\n   */\n  infoFail<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.INFO, {\n      metadataStyles,\n      symbol: '✖',\n      styles: ['red', 'bold'],\n    });\n  }\n\n  /**\n   * Log an debug fail message\n   */\n  debugFail<T extends Metadata>(\n    messageOrError: string | Error,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.log(messageOrError, metadata, Level.DEBUG, {\n      metadataStyles,\n      symbol: '✖',\n      styles: ['red'],\n    });\n  }\n\n  /**\n   * @returns {number} time to pass to timeEnd\n   */\n  time<T extends Metadata>(\n    message?: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n    level: number = Level.DEBUG,\n  ): number {\n    if (message) {\n      this.log(message, metadata, level, { metadataStyles });\n    }\n\n    return Date.now();\n  }\n\n  infoTime<T extends Metadata>(\n    message?: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): number {\n    return this.time(message, metadata, metadataStyles, Level.INFO);\n  }\n\n  /**\n   * Finds difference between when this method\n   * was called and when the respective time method\n   * was called, then logs out the difference\n   * and deletes the original record\n   */\n  timeEnd<T extends Metadata>(\n    startTime: number,\n    message: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n    level: number = Level.DEBUG,\n    options?: Options<T>,\n  ): void {\n    const now = Date.now();\n\n    const diffTime = now - startTime;\n    let readableTime;\n\n    if (diffTime < 1000) {\n      readableTime = `${diffTime}ms`;\n    } else {\n      const seconds = diffTime > 1000 ? Math.floor(diffTime / 1000) : 0;\n      const ms = diffTime - seconds * 1000;\n      readableTime = `${seconds ? `${seconds}s and ` : ''}${ms}ms`;\n    }\n\n    const extendedMetadata = {\n      ...metadata,\n      readableTime,\n      timeMs: diffTime,\n    };\n\n    this.log(message, extendedMetadata, level, { ...options, metadataStyles });\n  }\n\n  /**\n   * Like timeEnd, but with INFO level\n   */\n  infoTimeEnd<T extends Metadata>(\n    time: number,\n    message: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.timeEnd(time, message, metadata, metadataStyles, Level.INFO);\n  }\n\n  /**\n   * Like timeEnd, but with INFO level\n   */\n  infoSuccessTimeEnd<T extends Metadata>(\n    time: number,\n    message: string,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T>,\n  ): void {\n    this.timeEnd(time, message, metadata, metadataStyles, Level.INFO, {\n      symbol: '✔',\n      styles: ['green', 'bold'],\n    });\n  }\n\n  /**\n   * Log an enter in a function\n   *\n   * @example\n   * ```typescript\n   * class A {\n   *   method(arg1) {\n   *     logger.enter(method, { arg1 });\n   *     // Do your stuff\n   *   }\n   * }\n   * ```\n   *\n   */\n  enter<T extends Metadata, Fn extends (...args: unknown[]) => unknown>(\n    fn: Fn,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T & ExtendedFunctionNameMetadata>,\n  ): void {\n    const extendedMetadata = {\n      ...metadata,\n      functionName: fn.name,\n    };\n    this.log('enter', extendedMetadata, Level.TRACE, { metadataStyles });\n  }\n\n  /**\n   * Log an exit in a function\n   *\n   * @example\n   * ```typescript\n   * const logger = new Logger('myNamespace:A');\n   * class A {\n   *   method(arg1) {\n   *     // Do your stuff\n   *     logger.exit(method, { arg1 });\n   *   }\n   * }\n   * ```\n   */\n  exit<T extends Metadata, Fn extends (...args: unknown[]) => unknown>(\n    fn: Fn,\n    metadata?: T,\n    metadataStyles?: MetadataStyles<T & ExtendedFunctionNameMetadata>,\n  ): void {\n    const extendedMetadata = {\n      ...metadata,\n      functionName: fn.name,\n    };\n    this.log('exit', extendedMetadata, Level.TRACE, { metadataStyles });\n  }\n\n  /**\n   * Wrap around a function to log enter and exit of a function\n   *\n   * @example\n   * ```typescript\n   * const logger = new Logger('myNamespace:A');\n   * class A {\n   *   method() {\n   *     logger.wrap(method, () => {\n   *       // Do your stuff\n   *     });\n   *   }\n   * }\n   * ```\n   */\n  wrap<Fn extends (...args: unknown[]) => unknown>(\n    fn: Fn,\n    callback: () => void,\n  ): void;\n\n  wrap<T extends Metadata, Fn extends (...args: unknown[]) => unknown>(\n    fn: Fn,\n    metadata: T,\n    callback: () => void,\n  ): void;\n\n  wrap<T extends Metadata, Fn extends (...args: unknown[]) => unknown>(\n    fn: Fn,\n    metadata: T,\n    metadataStyles: MetadataStyles<T>,\n    callback: () => void,\n  ): void;\n\n  wrap<T extends Metadata, Fn extends (...args: unknown[]) => unknown>(\n    fn: Fn,\n    option1: T | (() => void),\n    option2?: MetadataStyles<T> | (() => void),\n    callback?: () => void,\n  ): void {\n    let metadata: T | undefined;\n    let metadataStyles: MetadataStyles<T> | undefined;\n\n    if (typeof option1 === 'function') {\n      callback = option1;\n    } else {\n      metadata = option1;\n\n      if (typeof option2 === 'function') {\n        callback = option2;\n      } else {\n        metadataStyles = option2;\n      }\n    }\n\n    this.enter(fn, metadata, metadataStyles);\n    (callback as () => void)();\n    this.exit(fn);\n  }\n}\n"],"names":["globalOrWindow","global","window","__NIGHTINGALE_GET_CONFIG_FOR_LOGGER","handlers","processors","__NIGHTINGALE_GET_CONFIG_FOR_LOGGER_RECORD","key","level","filter","handler","minLevel","isHandling","getConfigForLoggerRecord","recordLevel","isError","messageOrError","Error","Logger","constructor","displayName","includes","getHandlersAndProcessors","getConfig","child","childSuffixKey","childDisplayName","context","logger","setContext","getContextObject","contextObject","extendsContext","extendedContext","undefined","Object","assign","addRecord","record","length","Level","ERROR","console","log","message","forEach","process","some","handle","metadata","INFO","options","isMessageError","name","extendedMetadata","prototype","hasOwnProperty","call","error","datetime","Date","extra","trace","metadataStyles","TRACE","debug","DEBUG","notice","NOTICE","info","warn","WARN","critical","CRITICAL","fatal","FATAL","alert","ALERT","inspectValue","value","inspectedValue","util","inspect","depth","styles","inspectVar","varName","varValue","success","infoSuccess","symbol","debugSuccess","fail","infoFail","debugFail","time","now","infoTime","timeEnd","startTime","diffTime","readableTime","seconds","Math","floor","timeMs","infoTimeEnd","infoSuccessTimeEnd","enter","fn","functionName","exit","wrap","option1","option2","callback"],"mappings":"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"}