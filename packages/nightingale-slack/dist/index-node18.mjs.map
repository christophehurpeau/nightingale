{"version":3,"file":"index-node18.mjs","sources":["../src/createBody.ts","../src/index.ts"],"sourcesContent":["/* eslint-disable camelcase */\nimport { RawFormatter, MarkdownFormatter, Level } from \"nightingale\";\nimport type { LogRecord, Metadata } from \"nightingale-types\";\nimport type { SlackConfig } from \"./SlackConfig\";\n\nconst levelToSlackColor: Record<number, string> = {\n  [Level.TRACE]: \"#808080\",\n  [Level.DEBUG]: \"#808080\",\n  [Level.INFO]: \"#808080\",\n  [Level.WARN]: \"warning\",\n  [Level.ERROR]: \"danger\",\n  [Level.CRITICAL]: \"danger\",\n  [Level.FATAL]: \"danger\",\n  [Level.EMERGENCY]: \"danger\",\n};\n\nexport default function createBody<T extends Metadata>(\n  record: LogRecord<T>,\n  slackConfig: SlackConfig,\n): Record<string, unknown> {\n  const markdown = MarkdownFormatter.format(record);\n  const raw = RawFormatter.format(record);\n\n  return {\n    channel: slackConfig.channel,\n    username: slackConfig.username,\n    icon_url: slackConfig.iconUrl,\n    icon_emoji: slackConfig.iconEmoji,\n    attachments: [\n      {\n        fallback: raw,\n        title: record.message,\n        color: levelToSlackColor[record.level],\n        text: markdown,\n        mrkdwn_in: [\"text\"],\n      },\n    ],\n  };\n}\n","import type {\n  LogRecord,\n  Handle,\n  Metadata,\n  Handler,\n  Level,\n} from \"nightingale-types\";\nimport type { SlackConfig } from \"./SlackConfig\";\nimport createBody from \"./createBody\";\n\nexport type { SlackConfig } from \"./SlackConfig\";\n\nexport { default as createBody } from \"./createBody\";\n\nconst createHandler =\n  (slackConfig: SlackConfig) =>\n  <T extends Metadata>(record: LogRecord<T>) => {\n    const body = createBody(record, slackConfig);\n\n    fetch(slackConfig.webhookUrl, {\n      method: \"POST\",\n      body: JSON.stringify(body),\n    }).catch((error: unknown) => {\n      console.error(error);\n    });\n  };\n\nexport class SlackHandler implements Handler {\n  minLevel: Level;\n\n  handle: Handle;\n\n  constructor(slackConfig: SlackConfig, minLevel: Level) {\n    this.minLevel = minLevel;\n    this.handle = createHandler(slackConfig);\n  }\n}\n"],"names":["levelToSlackColor","Level","TRACE","DEBUG","INFO","WARN","ERROR","CRITICAL","FATAL","EMERGENCY","createBody","record","slackConfig","markdown","MarkdownFormatter","format","raw","RawFormatter","channel","username","icon_url","iconUrl","icon_emoji","iconEmoji","attachments","fallback","title","message","color","level","text","mrkdwn_in","createHandler","body","fetch","webhookUrl","method","JSON","stringify","catch","error","console","SlackHandler","constructor","minLevel","handle"],"mappings":";;AAAA;AAKA,MAAMA,iBAAyC,GAAG;AAChD,EAAA,CAACC,KAAK,CAACC,KAAK,GAAG,SAAS;AACxB,EAAA,CAACD,KAAK,CAACE,KAAK,GAAG,SAAS;AACxB,EAAA,CAACF,KAAK,CAACG,IAAI,GAAG,SAAS;AACvB,EAAA,CAACH,KAAK,CAACI,IAAI,GAAG,SAAS;AACvB,EAAA,CAACJ,KAAK,CAACK,KAAK,GAAG,QAAQ;AACvB,EAAA,CAACL,KAAK,CAACM,QAAQ,GAAG,QAAQ;AAC1B,EAAA,CAACN,KAAK,CAACO,KAAK,GAAG,QAAQ;EACvB,CAACP,KAAK,CAACQ,SAAS,GAAG,QAAA;AACrB,CAAC,CAAA;AAEc,SAASC,UAAUA,CAChCC,MAAoB,EACpBC,WAAwB,EACC;AACzB,EAAA,MAAMC,QAAQ,GAAGC,iBAAiB,CAACC,MAAM,CAACJ,MAAM,CAAC,CAAA;AACjD,EAAA,MAAMK,GAAG,GAAGC,YAAY,CAACF,MAAM,CAACJ,MAAM,CAAC,CAAA;EAEvC,OAAO;IACLO,OAAO,EAAEN,WAAW,CAACM,OAAO;IAC5BC,QAAQ,EAAEP,WAAW,CAACO,QAAQ;IAC9BC,QAAQ,EAAER,WAAW,CAACS,OAAO;IAC7BC,UAAU,EAAEV,WAAW,CAACW,SAAS;AACjCC,IAAAA,WAAW,EAAE,CACX;AACEC,MAAAA,QAAQ,EAAET,GAAG;MACbU,KAAK,EAAEf,MAAM,CAACgB,OAAO;AACrBC,MAAAA,KAAK,EAAE5B,iBAAiB,CAACW,MAAM,CAACkB,KAAK,CAAC;AACtCC,MAAAA,IAAI,EAAEjB,QAAQ;MACdkB,SAAS,EAAE,CAAC,MAAM,CAAA;KACnB,CAAA;GAEJ,CAAA;AACH;;ACxBA,MAAMC,aAAa,GAChBpB,WAAwB,IACJD,MAAoB,IAAK;AAC5C,EAAA,MAAMsB,IAAI,GAAGvB,UAAU,CAACC,MAAM,EAAEC,WAAW,CAAC,CAAA;AAE5CsB,EAAAA,KAAK,CAACtB,WAAW,CAACuB,UAAU,EAAE;AAC5BC,IAAAA,MAAM,EAAE,MAAM;AACdH,IAAAA,IAAI,EAAEI,IAAI,CAACC,SAAS,CAACL,IAAI,CAAA;AAC3B,GAAC,CAAC,CAACM,KAAK,CAAEC,KAAc,IAAK;AAC3BC,IAAAA,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC,CAAA;AACtB,GAAC,CAAC,CAAA;AACJ,CAAC,CAAA;AAEI,MAAME,YAAY,CAAoB;AAK3CC,EAAAA,WAAWA,CAAC/B,WAAwB,EAAEgC,QAAe,EAAE;IACrD,IAAI,CAACA,QAAQ,GAAGA,QAAQ,CAAA;AACxB,IAAA,IAAI,CAACC,MAAM,GAAGb,aAAa,CAACpB,WAAW,CAAC,CAAA;AAC1C,GAAA;AACF;;;;"}