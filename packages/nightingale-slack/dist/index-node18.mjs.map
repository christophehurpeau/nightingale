{"version":3,"file":"index-node18.mjs","sources":["../src/createBody.ts","../src/index.ts"],"sourcesContent":["/* eslint-disable camelcase */\nimport { Level } from 'nightingale-levels';\nimport markdownFormatter from 'nightingale-markdown-formatter';\nimport rawFormatter from 'nightingale-raw-formatter';\nimport type { LogRecord, Metadata } from 'nightingale-types';\nimport type { SlackConfig } from './SlackConfig';\n\nconst levelToSlackColor: Record<number, string> = {\n  [Level.TRACE]: '#808080',\n  [Level.DEBUG]: '#808080',\n  [Level.INFO]: '#808080',\n  [Level.WARN]: 'warning',\n  [Level.ERROR]: 'danger',\n  [Level.CRITICAL]: 'danger',\n  [Level.FATAL]: 'danger',\n  [Level.EMERGENCY]: 'danger',\n};\n\nexport default function createBody<T extends Metadata>(\n  record: LogRecord<T>,\n  slackConfig: SlackConfig,\n): Record<string, unknown> {\n  const markdown = markdownFormatter(record);\n  const raw = rawFormatter(record);\n\n  return {\n    channel: slackConfig.channel,\n    username: slackConfig.username,\n    icon_url: slackConfig.iconUrl,\n    icon_emoji: slackConfig.iconEmoji,\n    attachments: [\n      {\n        fallback: raw,\n        title: record.message,\n        color: levelToSlackColor[record.level],\n        text: markdown,\n        mrkdwn_in: ['text'],\n      },\n    ],\n  };\n}\n","import type {\n  LogRecord,\n  Handle,\n  Metadata,\n  Handler,\n  Level,\n} from 'nightingale-types';\nimport type { SlackConfig } from './SlackConfig';\nimport createBody from './createBody';\n\nexport type { SlackConfig } from './SlackConfig';\n\nexport { default as createBody } from './createBody';\n\nconst createHandler =\n  (slackConfig: SlackConfig) =>\n  <T extends Metadata>(record: LogRecord<T>) => {\n    const body = createBody(record, slackConfig);\n\n    fetch(slackConfig.webhookUrl, {\n      method: 'POST',\n      body: JSON.stringify(body),\n    }).catch((error: Error) => {\n      console.error(error.stack);\n    });\n  };\n\nexport class SlackHandler implements Handler {\n  minLevel: Level;\n\n  handle: Handle;\n\n  constructor(slackConfig: SlackConfig, minLevel: Level) {\n    this.minLevel = minLevel;\n    this.handle = createHandler(slackConfig);\n  }\n}\n"],"names":["levelToSlackColor","Level","TRACE","DEBUG","INFO","WARN","ERROR","CRITICAL","FATAL","EMERGENCY","createBody","record","slackConfig","markdown","markdownFormatter","raw","rawFormatter","channel","username","icon_url","iconUrl","icon_emoji","iconEmoji","attachments","fallback","title","message","color","level","text","mrkdwn_in","createHandler","body","fetch","webhookUrl","method","JSON","stringify","catch","error","console","stack","SlackHandler","constructor","minLevel","handle"],"mappings":";;;;AAAA;AAOA,MAAMA,iBAAyC,GAAG;AAChD,EAAA,CAACC,KAAK,CAACC,KAAK,GAAG,SAAS;AACxB,EAAA,CAACD,KAAK,CAACE,KAAK,GAAG,SAAS;AACxB,EAAA,CAACF,KAAK,CAACG,IAAI,GAAG,SAAS;AACvB,EAAA,CAACH,KAAK,CAACI,IAAI,GAAG,SAAS;AACvB,EAAA,CAACJ,KAAK,CAACK,KAAK,GAAG,QAAQ;AACvB,EAAA,CAACL,KAAK,CAACM,QAAQ,GAAG,QAAQ;AAC1B,EAAA,CAACN,KAAK,CAACO,KAAK,GAAG,QAAQ;EACvB,CAACP,KAAK,CAACQ,SAAS,GAAG,QAAA;AACrB,CAAC,CAAA;AAEc,SAASC,UAAUA,CAChCC,MAAoB,EACpBC,WAAwB,EACC;AACzB,EAAA,MAAMC,QAAQ,GAAGC,iBAAiB,CAACH,MAAM,CAAC,CAAA;AAC1C,EAAA,MAAMI,GAAG,GAAGC,YAAY,CAACL,MAAM,CAAC,CAAA;EAEhC,OAAO;IACLM,OAAO,EAAEL,WAAW,CAACK,OAAO;IAC5BC,QAAQ,EAAEN,WAAW,CAACM,QAAQ;IAC9BC,QAAQ,EAAEP,WAAW,CAACQ,OAAO;IAC7BC,UAAU,EAAET,WAAW,CAACU,SAAS;AACjCC,IAAAA,WAAW,EAAE,CACX;AACEC,MAAAA,QAAQ,EAAET,GAAG;MACbU,KAAK,EAAEd,MAAM,CAACe,OAAO;AACrBC,MAAAA,KAAK,EAAE3B,iBAAiB,CAACW,MAAM,CAACiB,KAAK,CAAC;AACtCC,MAAAA,IAAI,EAAEhB,QAAQ;MACdiB,SAAS,EAAE,CAAC,MAAM,CAAA;KACnB,CAAA;GAEJ,CAAA;AACH;;AC1BA,MAAMC,aAAa,GAChBnB,WAAwB,IACJD,MAAoB,IAAK;AAC5C,EAAA,MAAMqB,IAAI,GAAGtB,UAAU,CAACC,MAAM,EAAEC,WAAW,CAAC,CAAA;AAE5CqB,EAAAA,KAAK,CAACrB,WAAW,CAACsB,UAAU,EAAE;AAC5BC,IAAAA,MAAM,EAAE,MAAM;AACdH,IAAAA,IAAI,EAAEI,IAAI,CAACC,SAAS,CAACL,IAAI,CAAA;AAC3B,GAAC,CAAC,CAACM,KAAK,CAAEC,KAAY,IAAK;AACzBC,IAAAA,OAAO,CAACD,KAAK,CAACA,KAAK,CAACE,KAAK,CAAC,CAAA;AAC5B,GAAC,CAAC,CAAA;AACJ,CAAC,CAAA;AAEI,MAAMC,YAAY,CAAoB;AAK3CC,EAAAA,WAAWA,CAAC/B,WAAwB,EAAEgC,QAAe,EAAE;IACrD,IAAI,CAACA,QAAQ,GAAGA,QAAQ,CAAA;AACxB,IAAA,IAAI,CAACC,MAAM,GAAGd,aAAa,CAACnB,WAAW,CAAC,CAAA;AAC1C,GAAA;AACF;;;;"}