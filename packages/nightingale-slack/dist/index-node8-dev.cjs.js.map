{"version":3,"file":"index-node8-dev.cjs.js","sources":["../src/createBody.ts","../src/index.ts"],"sourcesContent":["/* eslint camelcase: \"off\" */\nimport markdownFormatter from 'nightingale-markdown-formatter';\nimport rawFormatter from 'nightingale-raw-formatter';\nimport Level from 'nightingale-levels';\nimport { Record } from 'nightingale-types';\nimport SlackConfig from './SlackConfig';\n\nconst levelToSlackColor: { [level: number]: string } = {\n  [Level.TRACE]: '#808080',\n  [Level.DEBUG]: '#808080',\n  [Level.INFO]: '#808080',\n  [Level.WARN]: 'warning',\n  [Level.ERROR]: 'danger',\n  [Level.CRITICAL]: 'danger',\n  [Level.FATAL]: 'danger',\n  [Level.EMERGENCY]: 'danger',\n};\n\nexport default <T>(record: Record<T>, slackConfig: SlackConfig) => {\n  const markdown = markdownFormatter(record);\n  const raw = rawFormatter(record);\n\n  return {\n    channel: slackConfig.channel,\n    username: slackConfig.username,\n    icon_url: slackConfig.iconUrl,\n    icon_emoji: slackConfig.iconEmoji,\n    attachments: [\n      {\n        fallback: raw,\n        title: record.message,\n        color: levelToSlackColor[record.level],\n        text: markdown,\n        mrkdwn_in: ['text'],\n      },\n    ],\n  };\n};\n","import { post } from 'request';\nimport { Record, Handle } from 'nightingale-types';\nimport SlackConfig from './SlackConfig';\nimport createBody from './createBody';\n\nconst createHandler = (slackConfig: SlackConfig) => <T>(record: Record<T>) => {\n  const body = createBody(record, slackConfig);\n\n  post({ url: slackConfig.webhookUrl, body, json: true }).on('error', (err2: Error) =>\n    console.error(err2.stack),\n  );\n};\n\nexport default class SlackHandler {\n  minLevel: number;\n  handle: Handle;\n\n  constructor(slackConfig: SlackConfig, minLevel: number) {\n    this.minLevel = minLevel;\n    this.handle = createHandler(slackConfig);\n  }\n}\n"],"names":["levelToSlackColor","Level","TRACE","DEBUG","INFO","WARN","ERROR","CRITICAL","FATAL","EMERGENCY","record","slackConfig","markdown","markdownFormatter","raw","rawFormatter","channel","username","iconUrl","iconEmoji","message","level","createHandler","body","createBody","webhookUrl","on","err2","console","error","stack","SlackHandler","minLevel","handle"],"mappings":";;;;;;;;;;;AAAA;AACA,AAMA,MAAMA,oBAAiD;GACpDC,MAAMC,KAAP,GAAe,SADsC;GAEpDD,MAAME,KAAP,GAAe,SAFsC;GAGpDF,MAAMG,IAAP,GAAc,SAHuC;GAIpDH,MAAMI,IAAP,GAAc,SAJuC;GAKpDJ,MAAMK,KAAP,GAAe,QALsC;GAMpDL,MAAMM,QAAP,GAAkB,QANmC;GAOpDN,MAAMO,KAAP,GAAe,QAPsC;GAQpDP,MAAMQ,SAAP,GAAmB;CARrB;AAWA,kBAAgB,CAAGC,MAAH,EAAsBC,WAAtB,KAAmD;QAC3DC,WAAWC,kBAAkBH,MAAlB,CAAjB;QACMI,MAAMC,aAAaL,MAAb,CAAZ;SAEO;aACIC,YAAYK,OADhB;cAEKL,YAAYM,QAFjB;cAGKN,YAAYO,OAHjB;gBAIOP,YAAYQ,SAJnB;iBAKQ,CACX;gBACYL,GADZ;aAESJ,OAAOU,OAFhB;aAGSpB,kBAAkBU,OAAOW,KAAzB,CAHT;YAIQT,QAJR;iBAKa,CAAC,MAAD;KANF;GALf;CAJF;;ACbA,MAAMU,gBAAiBX,WAAD,IAAkCD,MAAH,IAAyB;QACtEa,OAAOC,WAAWd,MAAX,EAAmBC,WAAnB,CAAb;eAEK;SAAOA,YAAYc,UAAnB;QAAA;UAA2C;GAAhD,EAAwDC,EAAxD,CAA2D,OAA3D,EAAqEC,IAAD,IAClEC,QAAQC,KAAR,CAAcF,KAAKG,KAAnB,CADF;CAHF;;AAQA,AAAe,MAAMC,YAAN,CAAmB;cAIpBpB,WAAZ,EAAsCqB,QAAtC,EAAwD;SAHxDA,QAGwD;SAFxDC,MAEwD;SACjDD,QAAL,GAAgBA,QAAhB;SACKC,MAAL,GAAcX,cAAcX,WAAd,CAAd;;;;;;;"}