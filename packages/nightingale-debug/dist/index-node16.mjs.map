{"version":3,"file":"index-node16.mjs","sources":["../src/index.ts"],"sourcesContent":["/* eslint-disable complexity */\nimport { Level } from 'nightingale-levels';\n\nconst specialRegexpChars = /[$()+.?[\\\\\\]^{|}]/;\n\ntype TestFunction = (string: string) => boolean;\nexport type DebugValueType = string | RegExp | string[];\n\nconst createTestFunctionFromRegexp =\n  (regexp: RegExp): TestFunction =>\n  (string: string) =>\n    regexp.test(string);\n\nconst createTestFunctionFromRegexpString = (value: string): TestFunction => {\n  if (!value.endsWith('/')) throw new Error('Invalid RegExp DEBUG value');\n  return createTestFunctionFromRegexp(new RegExp(value.slice(1, -1)));\n};\n\nconst createTestFunctionFromValue = (value: string): TestFunction => {\n  if (value.endsWith(':*')) {\n    value = value.slice(0, -2);\n    return (string: string) => string.startsWith(value);\n  }\n\n  return (string: string) => string === value;\n};\n\nexport type FindDebugLevel = (minLevel: Level, key: string) => Level;\n\nexport function createFindDebugLevel(\n  debugValue?: DebugValueType,\n): FindDebugLevel {\n  let isWildcard = false;\n  const debugValues: TestFunction[] = [];\n  const skips: TestFunction[] = [];\n\n  if (!Array.isArray(debugValue)) {\n    if (debugValue instanceof RegExp) {\n      debugValues.push(createTestFunctionFromRegexp(debugValue));\n      debugValue = undefined;\n    } else if (debugValue) {\n      debugValue = debugValue.trim();\n\n      if (debugValue.startsWith('/')) {\n        debugValues.push(createTestFunctionFromRegexpString(debugValue));\n        debugValue = undefined;\n      } else {\n        debugValue = debugValue.split(/[\\s,]+/);\n      }\n    }\n  }\n\n  if (debugValue) {\n    (debugValue as string[]).forEach((value) => {\n      if (specialRegexpChars.test(value)) {\n        throw new Error(\n          `Invalid debug value: \"${value}\" (contains special chars)`,\n        );\n      }\n\n      if (!value) return;\n\n      if (value === '*') {\n        isWildcard = true;\n        return;\n      }\n\n      if (value.startsWith('-')) {\n        skips.push(createTestFunctionFromValue(value.slice(1)));\n      } else if (!isWildcard) {\n        debugValues.push(createTestFunctionFromValue(value));\n      }\n    });\n  }\n\n  if (isWildcard) {\n    if (skips.length === 0) {\n      return () => Level.ALL;\n    } else {\n      return (minLevel: Level, key: string) =>\n        skips.some((skip) => skip(key)) ? minLevel : Level.ALL;\n    }\n  }\n\n  if (debugValues.length === 0) {\n    return (minLevel: Level) => minLevel;\n  }\n\n  return (minLevel: Level, key: string) => {\n    if (minLevel === Level.ALL || !key) {\n      return minLevel;\n    }\n\n    if (debugValues.some((dv) => dv(key))) {\n      return skips.some((skip) => skip(key)) ? minLevel : Level.ALL;\n    }\n\n    return minLevel;\n  };\n}\n"],"names":["specialRegexpChars","createTestFunctionFromRegexp","regexp","string","test","createTestFunctionFromRegexpString","value","endsWith","Error","RegExp","slice","createTestFunctionFromValue","startsWith","createFindDebugLevel","debugValue","isWildcard","debugValues","skips","Array","isArray","push","undefined","trim","split","forEach","length","Level","ALL","minLevel","key","some","skip","dv"],"mappings":"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"}